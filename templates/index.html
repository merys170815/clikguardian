<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>ClickShield — Panel de Protección</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/static/main.css">

  <style>
    body { font-family: system-ui, Segoe UI, Arial; margin: 0; background:#0d1117; color:#e6edf3; }
    header { padding:16px 20px; border-bottom:1px solid #222; }
    h1 { margin:0; font-size:22px; font-weight:600; }

    .wrap { max-width:1100px; margin:20px auto; padding:0 16px; }
    .controls { display:flex; gap:8px; align-items:center; margin-bottom:12px; }

    input[type="text"]{
      padding:8px 10px; border:1px solid #333;
      background:#0f1420; color:#e6edf3; border-radius:8px;
      outline:none;
    }
    button {
      padding:8px 12px; border:1px solid #333;
      background:#1a2030; color:#e6edf3;
      border-radius:8px; cursor:pointer;
    }
    button.danger { border-color:#5f1b20; background:#2a0f12; }

    table { width:100%; border-collapse:collapse; }
    th, td {
      text-align:left; padding:8px;
      border-bottom:1px solid #1e2637;
    }
    th { background:#111827; position:sticky; top:0; z-index:1; }

    .badge {
      padding:2px 8px; border-radius:999px;
      font-size:12px; border:1px solid #334;
    }
    .alto  { background:#2a0f12; border-color:#5f1b20; color:#ffb3b8; }
    .medio { background:#2a240f; border-color:#5f4d1b; color:#ffe2a8; }
    .bajo  { background:#0f2a19; border-color:#1b5f3b; color:#b7ffd9; }

    .mono { font-family: ui-monospace, monospace; }
  </style>
</head>

<body>
  <header>
    <h1>ClickShield — Protección Contra Clics Inválidos</h1>
    <div style="opacity:.7;font-size:12px">
      Panel con geolocalización, análisis de riesgo y bloqueo de IPs.
    </div>
  </header>

  <div class="wrap">

    <!-- ✅ CONTROLES -->
    <div class="controls">
      <input id="search" type="text" placeholder="Buscar por IP, ciudad, zona, operador, dispositivo…" />
      <label style="display:flex;align-items:center;gap:6px;">
        <input id="onlySuspicious" type="checkbox"/> Solo sospechosos
      </label>
      <button id="refresh">Actualizar</button>
      <button id="exportIPs">Exportar IPs bloqueadas</button>
    </div>

    <!-- ✅ TABLA DE EVENTOS -->
    <div style="overflow:auto; max-height:70vh; border:1px solid #1e2637; border-radius:10px;">
      <table id="tbl">
        <thead>
          <tr>
            <th>Hora</th>
            <th>IP / Operador</th>
            <th>Ciudad / Localidad</th>
            <th>Dispositivo (User-Agent)</th>
            <th>Referencia</th>
            <th>Tiempo en la página</th>
            <th>Nivel de Riesgo</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

    <!-- ✅ SCRIPT DE TRACKING -->
    <h3 style="margin-top:24px;">Script de seguimiento (tracking)</h3>
    <p>Pega este código dentro del <code>&lt;body&gt;</code> de tu página web:</p>

    <pre style="white-space:pre-wrap;background:#0f1420;border:1px solid #1e2637;padding:10px;border-radius:10px;">
&lt;script&gt;
(function(){
  const start = performance.now();
  function enviar(tipo){
    const body = {
      type: tipo,
      ts: new Date().toISOString(),
      url: location.href,
      ref: document.referrer,
      ua: navigator.userAgent,
      lang: navigator.language,
      screen: { w: screen.width, h: screen.height }
    };
    if(tipo === "leave") body.dwell_ms = Math.round(performance.now() - start);

    navigator.sendBeacon("https://medigoencas.com/track",
      new Blob([JSON.stringify(body)], {type:"application/json"}));
  }
  enviar("land");
  window.addEventListener("beforeunload", ()=>enviar("leave"));
})();
&lt;/script&gt;
    </pre>

  </div>

  <script src="/static/app.js"></script>
</body>
</html>
